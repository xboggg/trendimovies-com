---
import BaseLayout from '../../layouts/BaseLayout.astro';
import MovieGrid from '../../components/MovieGrid.svelte';
import { discoverMovies } from '../../lib/tmdb';

// Fetch top rated movies from 2026
const data = await discoverMovies({
  'primary_release_date.gte': '2026-01-01',
  'primary_release_date.lte': '2026-12-31',
  sort_by: 'vote_average.desc',
  'vote_count.gte': '20'
});

const movies = (data?.results || []).map((m: any) => ({
  id: m.id,
  tmdb_id: m.id,
  title: m.title,
  poster_path: m.poster_path,
  backdrop_path: m.backdrop_path,
  vote_average: m.vote_average,
  year: m.release_date ? new Date(m.release_date).getFullYear() : null,
  type: 'movie' as const
}));
---

<BaseLayout
  title="Top Movies of 2026 - Highest Rated Films"
  description="Discover the highest rated movies of 2026. Browse the best films released this year."
>
  <section class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <div class="flex items-center justify-between mb-8">
      <div>
        <h1 class="text-2xl md:text-4xl font-bold" style="color: var(--text-primary);">
          Top Movies of 2026
        </h1>
        <p class="mt-2" style="color: var(--text-secondary);">
          The highest rated films released in 2026
        </p>
      </div>
      <span class="px-4 py-2 rounded-full text-sm font-bold bg-amber-500 text-black">
        2026
      </span>
    </div>

    <MovieGrid client:load items={movies} />

    {movies.length === 0 && (
      <div class="text-center py-12" style="color: var(--text-secondary);">
        <p>No movies found for 2026 yet. Check back later!</p>
      </div>
    )}
  </section>
</BaseLayout>
